<?php
include('config.php');
header("Content-Type: application/json");
$id = isset($_REQUEST['id']) ? $_REQUEST['id'] : 1;
$result = array();
$sql = "
    SELECT u.id, pseudo 
    FROM users AS u 
    INNER JOIN relations AS r 
        ON r.user_id_2 = u.id 
    WHERE r.user_id_1 = :id 
    UNION 
    SELECT u.id, pseudo 
    FROM users AS u 
    INNER JOIN relations AS r 
        ON r.user_id_1 = u.id 
    WHERE r.user_id_2 = :id
    ";

$req = $db->prepare($sql);
$req->bindValue(':id', $id);
$req->execute();
$res = $req->fetchAll();
$result = [];
foreach($res as $value) {
    $user['pseudo'] = $value['pseudo'];
    $user['id'] = $value['id'];
    $result[] = $user;
}
print(json_encode($result));
